{% extends "admin/base.html" %}
{% load static %}

{% block title %}Главная{% endblock %}

{% block content %}
    <div class="main-content-inner">
        <div class="main-content-wrap">
            <div class="flex items-center flex-wrap justify-between gap20 mb-27">
                <h3>Настройки</h3>
                <ul class="breadcrumbs flex items-center flex-wrap justify-start gap10">
                    <li>
                        <a href="index.html">
                            <div class="text-tiny">Dashboard</div>
                        </a>
                    </li>
                    <li><i class="icon-chevron-right"></i></li>
                    <li>
                        <div class="text-tiny">Настройки</div>
                    </li>
                </ul>
            </div>

            <!-- setting -->
            <form class="form-setting form-style-2" method="post">
                {% csrf_token %}

                <div class="wg-box">
                    <div class="left">
                        <h5 class="mb-4">Данные магазина</h5>
                        <div class="body-text">Основные данные</div>
                    </div>

                    <div class="right flex-grow">
                        <fieldset class="name mb-24">
                            <div class="body-title mb-10">Название магазина</div>
                            <input class="flex-grow" type="text" placeholder="Введите название магазина"
                                   name="name" value="{{ store.name|default:'' }}" required>
                        </fieldset>

                        <fieldset class="text mb-24">
                            <div class="flex items-center justify-between gap10 mb-10">
                                <div class="body-title">Слоган магазина</div>
                            </div>
                            <input class="flex-grow" type="text" placeholder="Краткая информация о магазине"
                                   name="slogan" value="{{ store.slogan|default:'' }}">
                        </fieldset>

                        <fieldset class="text mb-24">
                            <div class="flex items-center justify-between gap10 mb-10">
                                <div class="body-title">Почта</div>
                            </div>
                            <input class="flex-grow" type="email" placeholder="Почта магазина"
                                   name="email" value="{{ store.email|default:'' }}">
                        </fieldset>

                        <fieldset class="text mb-24">
                            <div class="flex items-center justify-between gap10 mb-10">
                                <div class="body-title">Телефон</div>
                            </div>
                            <input class="flex-grow" type="tel" placeholder="Телефон магазина"
                                   name="phone" value="{{ store.phone|default:'' }}">
                        </fieldset>
                    </div>
                </div>

                <div class="wg-box">
                    <div class="left">
                        <h5 class="mb-4">Соцсети</h5>
                        <div class="body-text">Соцсети магазина</div>
                    </div>

                    <!-- ЛЕВАЯ КОЛОНКА: НАЗВАНИЕ -->
                    <div class="right flex-grow">
                        {% if socials %}
                            {% for s in socials %}
                                <fieldset class="email mb-10 add-more-right">
                                    <div class="body-title mb-10">Название</div>
                                    <input class="flex-grow" type="text" placeholder="Instagram / Telegram / WhatsApp"
                                           name="social_name[]" value="{{ s.name|default:'' }}">
                                </fieldset>
                            {% endfor %}
                        {% else %}
                            <fieldset class="email mb-10 add-more-right">
                                <div class="body-title mb-10">Название</div>
                                <input class="flex-grow" type="text" placeholder="Instagram / Telegram / WhatsApp"
                                       name="social_name[]">
                            </fieldset>
                        {% endif %}
                    </div>

                    <!-- ПРАВАЯ КОЛОНКА: ССЫЛКА -->
                    <div class="right flex-grow">
                        {% if socials %}
                            {% for s in socials %}
                                <fieldset class="email mb-10 add-more-right">
                                    <div class="body-title mb-10">Ссылка</div>
                                    <input class="flex-grow" type="url" placeholder="https://..."
                                           name="social_link[]" value="{{ s.link|default:'' }}">
                                </fieldset>
                            {% endfor %}
                        {% else %}
                            <fieldset class="email mb-10 add-more-right">
                                <div class="body-title mb-10">Ссылка</div>
                                <input class="flex-grow" type="url" placeholder="https://..."
                                       name="social_link[]">
                            <a href="#" class="tf-button add-more">
                Add more <i class="icon-plus"></i>
            </a>
                            </fieldset>
                        {% endif %}
                    </div>
                </div>

                <button type="submit" class="tf-button w180 m-auto">Сохранить</button>
            </form>
            <!-- /setting -->
        </div>
    </div>
    <script>
        document.addEventListener('click', function (e) {
            const btn = e.target.closest('.add-more');
            if (!btn) return;

            e.preventDefault();

            // оба родительских контейнера
            const allRight = btn.closest('.right.flex-grow')
                .parentNode
                .querySelectorAll('.right.flex-grow');

            const nameCol = allRight[0];
            const linkCol = allRight[1];

            // последние fieldset в каждой колонке
            const lastNameFs = nameCol.querySelector('fieldset:last-of-type');
            const lastLinkFs = linkCol.querySelector('fieldset:last-of-type');

            // клонируем
            const nameClone = lastNameFs.cloneNode(true);
            const linkClone = lastLinkFs.cloneNode(true);

            // очистка
            nameClone.querySelectorAll('input').forEach(i => i.value = '');
            linkClone.querySelectorAll('input').forEach(i => i.value = '');

            // кнопку переносим в новый последний fieldset
            btn.remove();
            linkClone.querySelector('.add-more')?.remove();
            linkClone.querySelector('fieldset')?.appendChild(btn);

            // добавляем в конец колонок
            nameCol.appendChild(nameClone);
            linkCol.appendChild(linkClone);

            // вернуть кнопку в новый link fieldset
            linkClone.appendChild(btn);
        });
    </script>

{% endblock %}